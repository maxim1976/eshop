# Nixpacks configuration for Django deployment on Railway
# This forces Python detection even with package.json present

[variables]
NIXPACKS_PYTHON_VERSION = "3.10"
DJANGO_SETTINGS_MODULE = "eshop.settings.production"
RAILWAY_ENVIRONMENT = "production"

[phases.setup]
nixPkgs = ["python310", "postgresql", "gettext"]

[phases.install] 
cmds = [
    "python -m pip install --upgrade pip",
    "pip install -r requirements.txt"
]

[phases.build]
cmds = [
    "python manage.py compilemessages --ignore=node_modules",
    "python manage.py collectstatic --noinput --clear"
]

[start]
cmd = "gunicorn --bind 0.0.0.0:$PORT --timeout 60 --workers 2 --access-logfile - --error-logfile - eshop.wsgi:application"